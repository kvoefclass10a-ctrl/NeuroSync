<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700&amp;family=Story+Script%3Awght%40400" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<title>NeuroSync Dashboard</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-storage-compat.js"></script>
<link rel="stylesheet" href="../css/mobile-optimizations.css">
<script>
// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyCFQ36vxZ5qWhxXXptKe_sXlFVZxzRtCBY",
  authDomain: "neurosync-5173b.firebaseapp.com",
  projectId: "neurosync-5173b",
  storageBucket: "neurosync-5173b.firebasestorage.app",
  messagingSenderId: "855780859936",
  appId: "1:855780859936:web:3044309100db9a61fa1c45",
  measurementId: "G-75S5GWYEDK"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

        let userProfile = null;

        // Get current user and update UI
        auth.onAuthStateChanged(async (user) => {
  if (user) {
                await loadUserProfile(user);
                await loadDashboardData(user.uid);
            } else {
                window.location.href = 'auth.html';
            }
        });

        async function loadUserProfile(user) {
    try {
      const docRef = db.collection('Profiles').doc(user.uid);
      const docSnap = await docRef.get();
                userProfile = docSnap.exists ? docSnap.data() : {};
                console.log('User profile data:', userProfile);

      // Show navbar profile section
      const navbarProfile = document.getElementById('navbar-profile');
      if (navbarProfile) navbarProfile.style.display = 'flex';

      // Update side menu profile photo
      const sidePhotoDiv = document.getElementById('side-profile-photo');
      if (sidePhotoDiv) {
                if (userProfile.photoUrl) {
                    sidePhotoDiv.style.backgroundImage = `url("${userProfile.photoUrl}")`;
        sidePhotoDiv.innerHTML = '';
      } else {
        sidePhotoDiv.style.backgroundImage = 'none';
        sidePhotoDiv.innerHTML = '<span class="material-symbols-outlined text-xl text-[var(--primary-color)] flex items-center justify-center w-full h-full">person</span>';
      }
      }

      // Update navbar profile photo
      const navbarPhotoDiv = document.getElementById('navbar-profile-photo');
      if (navbarPhotoDiv) {
                if (userProfile.photoUrl) {
                    navbarPhotoDiv.style.backgroundImage = `url("${userProfile.photoUrl}")`;
        navbarPhotoDiv.innerHTML = '';
      } else {
        navbarPhotoDiv.style.backgroundImage = 'none';
        navbarPhotoDiv.innerHTML = '<span class="material-symbols-outlined text-xl text-[var(--primary-color)] flex items-center justify-center w-full h-full">person</span>';
      }
      }

                // Update side menu name
                const displayName = `${userProfile.firstname || ''} ${userProfile.lastname || ''}`.trim() || user.displayName || user.email.split('@')[0] || '';
      const sideName = document.getElementById('side-name');
      if (sideName) sideName.textContent = displayName || 'User';
                console.log('Display name:', displayName);

      // Update navbar name
      const navbarName = document.getElementById('navbar-name');
      if (navbarName) navbarName.textContent = displayName || 'User';

      // Update side menu class
                const userClass = userProfile.class || 'Student';
      const sideClass = document.getElementById('side-class-role');
      if (sideClass) sideClass.textContent = userClass;
                console.log('User class:', userClass);

      // Update navbar class
      const navbarClass = document.getElementById('navbar-class-role');
      if (navbarClass) navbarClass.textContent = userClass;

                // Show teacher dashboard link for teachers
                if (userProfile.role === 'Teacher') {
                    document.getElementById('teacher-dashboard-link').style.display = 'flex';
                }

      // Update welcome message
                const firstName = userProfile.firstname || displayName.split(' ')[0];
      document.getElementById('welcome-message').textContent = `Welcome back, ${firstName}! Let's make today productive.`;

    } catch (error) {
      console.error('Error loading profile:', error);
            }
        }

        async function loadDashboardData(userId) {
            try {
                await Promise.all([
                    loadRewardsData(userId),
                    loadFocusStats(userId),
                    loadMoodStats(userId),
                    loadRecentActivity(userId),
                    loadStudyMaterials(userId)
                ]);
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

// Load rewards data
async function loadRewardsData(userId) {
  try {
    const rewardsDoc = await db.collection('Rewards').doc(userId).get();
    if (rewardsDoc.exists()) {
      const rewards = rewardsDoc.data();
      const pointsElement = document.getElementById('focus-points');
      const levelElement = document.getElementById('avatar-level');
      const progressBar = document.getElementById('level-progress');

      if (pointsElement) pointsElement.textContent = rewards.totalPoints || 0;
      if (levelElement) levelElement.textContent = `Lvl ${rewards.avatarLevel || 1}`;

      // Calculate progress to next level
      const currentLevel = rewards.avatarLevel || 1;
      const currentPoints = rewards.totalPoints || 0;
      const levelThresholds = [0, 50, 150, 300, 500];
      const currentThreshold = levelThresholds[currentLevel - 1] || 0;
      const nextThreshold = levelThresholds[currentLevel] || 500;
      const progress = ((currentPoints - currentThreshold) / (nextThreshold - currentThreshold)) * 100;

      if (progressBar) {
        progressBar.style.width = `${Math.min(progress, 100)}%`;
      }
    }
  } catch (error) {
    console.error('Error loading rewards:', error);
  }
}

        // Load focus session statistics
        async function loadFocusStats(userId) {
            try {
                const sessionsSnapshot = await db.collection('FocusSessions')
                    .where('userId', '==', userId)
                    .where('completed', '==', true)
                    .get();

                let totalSessions = 0;
                let totalMinutes = 0;
                let todaySessions = 0;
                let todayMinutes = 0;
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                sessionsSnapshot.forEach(doc => {
                    const session = doc.data();
                    totalSessions++;
                    totalMinutes += session.duration || 0;
                    
                    if (session.endTime && session.endTime.toDate() >= today) {
                        todaySessions++;
                        todayMinutes += session.duration || 0;
                    }
                });

                document.getElementById('total-sessions').textContent = totalSessions;
                document.getElementById('total-minutes').textContent = totalMinutes;
                document.getElementById('today-sessions').textContent = todaySessions;
                document.getElementById('today-minutes').textContent = todayMinutes;

            } catch (error) {
                console.error('Error loading focus stats:', error);
            }
        }

        // Load mood statistics
        async function loadMoodStats(userId) {
            try {
                const moodsSnapshot = await db.collection('Moods')
                    .where('userId', '==', userId)
                    .orderBy('timestamp', 'desc')
                    .limit(7)
                    .get();

                const moodData = [];
                moodsSnapshot.forEach(doc => {
                    moodData.push(doc.data());
                });

                // Update mood trend
                if (moodData.length > 0) {
                    const avgMood = moodData.reduce((sum, mood) => sum + mood.level, 0) / moodData.length;
                    document.getElementById('avg-mood').textContent = avgMood.toFixed(1);
                    document.getElementById('mood-trend').textContent = moodData.length >= 2 ? 
                        (moodData[0].level > moodData[1].level ? '‚ÜóÔ∏è Improving' : 
                         moodData[0].level < moodData[1].level ? '‚ÜòÔ∏è Declining' : '‚Üí Stable') : '‚Üí New';
                }

                // Display recent moods
                const recentMoodsContainer = document.getElementById('recent-moods');
                recentMoodsContainer.innerHTML = '';
                
                moodData.slice(0, 5).forEach(mood => {
                    const moodItem = document.createElement('div');
                    moodItem.className = 'flex items-center justify-between p-2 bg-tertiary rounded-lg';
                    moodItem.innerHTML = `
                        <div class="flex items-center gap-2">
                            <span class="text-lg">${getMoodEmoji(mood.mood)}</span>
                            <span class="text-sm">${mood.mood}</span>
                        </div>
                        <span class="text-xs text-secondary">${new Date(mood.timestamp.toDate()).toLocaleDateString()}</span>
                    `;
                    recentMoodsContainer.appendChild(moodItem);
                });

            } catch (error) {
                console.error('Error loading mood stats:', error);
            }
        }

        // Load recent activity
        async function loadRecentActivity(userId) {
            try {
                const activityContainer = document.getElementById('recent-activity');
                activityContainer.innerHTML = '';

                // Get recent focus sessions
                const recentSessions = await db.collection('FocusSessions')
                    .where('userId', '==', userId)
                    .orderBy('startTime', 'desc')
                    .limit(3)
                    .get();

                recentSessions.forEach(doc => {
                    const session = doc.data();
                    const activityItem = document.createElement('div');
                    activityItem.className = 'flex items-center gap-3 p-3 bg-tertiary rounded-lg';
                    activityItem.innerHTML = `
                        <span class="material-symbols-outlined text-accent">timer</span>
                        <div class="flex-1">
                            <p class="text-sm font-medium">Focus Session</p>
                            <p class="text-xs text-secondary">${session.duration || 0} minutes ‚Ä¢ ${new Date(session.startTime.toDate()).toLocaleDateString()}</p>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full ${session.completed ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}">
                            ${session.completed ? 'Completed' : 'Incomplete'}
                        </span>
                    `;
                    activityContainer.appendChild(activityItem);
                });

            } catch (error) {
                console.error('Error loading recent activity:', error);
            }
        }

        // Load study materials
        async function loadStudyMaterials(userId) {
            try {
                const materialsSnapshot = await db.collection('StudyLibrary')
                    .where('uploadedBy', '==', userId)
                    .orderBy('uploadDate', 'desc')
                    .limit(3)
                    .get();

                const materialsContainer = document.getElementById('recent-materials');
                materialsContainer.innerHTML = '';

                if (materialsSnapshot.empty) {
                    materialsContainer.innerHTML = '<p class="text-secondary text-sm">No materials uploaded yet.</p>';
                    return;
                }

                materialsSnapshot.forEach(doc => {
                    const material = doc.data();
                    const materialItem = document.createElement('div');
                    materialItem.className = 'flex items-center gap-3 p-3 bg-tertiary rounded-lg';
                    materialItem.innerHTML = `
                        <span class="material-symbols-outlined text-accent">description</span>
                        <div class="flex-1">
                            <p class="text-sm font-medium">${material.title || 'Untitled'}</p>
                            <p class="text-xs text-secondary">${material.subject} ‚Ä¢ ${material.type}</p>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full ${material.approved ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}">
                            ${material.approved ? 'Approved' : 'Pending'}
                        </span>
                    `;
                    materialsContainer.appendChild(materialItem);
                });

            } catch (error) {
                console.error('Error loading study materials:', error);
            }
        }

        function getMoodEmoji(mood) {
            const emojiMap = {
                'Happy': 'üòÑ',
                'Neutral': 'üòê',
                'Sad': 'üòî',
                'Anxious': 'üòü',
                'Excited': 'ü§©'
            };
            return emojiMap[mood] || 'üòê';
        }

        // Navbar sign out functionality
        function signOut() {
            firebase.auth().signOut().then(() => {
                window.location.href = '../index.html';
            }).catch((error) => {
                console.error('Sign out error:', error);
            });
}
</script>
<style type="text/tailwindcss">
        :root {
            --primary-color: #8013ec;
            --bg-primary: #120B1A;
            --bg-secondary: #1A1122;
            --bg-tertiary: #2A1F36;
            --text-primary: #FFFFFF;
            --text-secondary: #ad92c9;
            --border-primary: #2A1F36;
        }

        .translucent-button {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: #FFFFFF;
            transition: all 0.3s ease;
        }
        .translucent-button:hover {
            background-color: rgba(147, 51, 234, 0.8);
            border: 1px solid rgba(147, 51, 234, 1);
            box-shadow: 0 0 15px rgba(147, 51, 234, 0.7);
            color: #FFFFFF;
        }
        .text-primary { color: #FFFFFF; }
        .text-secondary { color: #ad92c9; }
        .accent-primary { color: var(--primary-color); }
        .border-primary { border-color: #2A1F36; }
        .bg-primary { background-color: #120B1A; }
        .bg-secondary { background-color: #1A1122; }
        .bg-tertiary { background-color: #2A1F36; }
    </style>
</head>
<body class="bg-primary text-primary">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-primary px-4 sm:px-6 lg:px-10 py-3 bg-transparent backdrop-blur-sm sticky top-0 z-20">
<div class="flex items-center gap-3 text-primary">
<svg class="h-7 w-7 accent-primary" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M36.7273 44C33.9891 44 31.6043 39.8386 30.3636 33.69C29.123 39.8386 26.7382 44 24 44C21.2618 44 18.877 39.8386 17.6364 33.69C16.3957 39.8386 14.0109 44 11.2727 44C7.25611 44 4 35.0457 4 24C4 12.9543 7.25611 4 11.2727 4C14.0109 4 16.3957 8.16144 17.6364 14.31C18.877 8.16144 21.2618 4 24 4C26.7382 4 29.123 8.16144 30.3636 14.31C31.6043 8.16144 33.9891 4 36.7273 4C40.7439 4 44 12.9543 44 24C44 35.0457 40.7439 44 36.7273 44Z" fill="currentColor"></path>
</svg>
<h2 class="text-primary text-xl font-bold tracking-tight" style='font-family: "Story Script", sans-serif;'>NeuroSync</h2>
</div>
<nav class="hidden xl:flex items-center gap-2 text-sm text-secondary">
<a class="translucent-button rounded-full px-4 py-2 hover:text-primary transition-colors" href="../index.html">Home</a>
<a href="Dashboard.html" id="dashboard-nav-link" class="translucent-button rounded-full px-4 py-2 hover:text-primary transition-colors flex items-center gap-1" style="display: none;">
<span>Dashboard</span>
</a>
<div class="relative group">
<button class="translucent-button rounded-full px-4 py-2 hover:text-primary transition-colors flex items-center gap-1 dropdown-toggle">
<span>Resources</span>
<span class="material-symbols-outlined text-base">expand_more</span>
</button>
<div class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 rounded-md shadow-lg bg-secondary/80 backdrop-blur-sm border border-primary ring-1 ring-black ring-opacity-5 focus:outline-none hidden">
<div class="py-1">
                        <a class="block px-4 py-2 text-sm text-secondary hover:bg-primary/50 hover:text-primary transition-colors" href="mood-selection.html">Mood Tracker</a>
                        <a class="block px-4 py-2 text-sm text-secondary hover:bg-primary/50 hover:text-primary transition-colors" href="study-library.html">Study Library</a>
                        <a class="block px-4 py-2 text-sm text-secondary hover:bg-primary/50 hover:text-primary transition-colors" href="study-library.html">Upload Material</a>
</div>
</div>
</div>
<div class="relative group">
<button class="translucent-button rounded-full px-4 py-2 hover:text-primary transition-colors flex items-center gap-1 dropdown-toggle">
<span>Company</span>
<span class="material-symbols-outlined text-base">expand_more</span>
</button>
<div class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 rounded-md shadow-lg bg-secondary/80 backdrop-blur-sm border border-primary ring-1 ring-black ring-opacity-5 focus:outline-none hidden">
<div class="py-1">
                        <a class="block px-4 py-2 text-sm text-secondary hover:bg-primary/50 hover:text-primary transition-colors" href="feedback.html">Feedback Us</a>
                        <a class="block px-4 py-2 text-sm text-secondary hover:bg-primary/50 hover:text-primary transition-colors" href="#about">About Us</a>
                        <a class="block px-4 py-2 text-sm text-secondary hover:bg-primary/50 hover:text-primary transition-colors" href="#support">Support</a>
</div>
</div>
</div>
<a href="rewards.html" id="rewards-nav-link" class="translucent-button rounded-full px-4 py-2 hover:text-primary transition-colors" style="display: none;">Rewards</a>
<a href="profile.html" id="profile-nav-link" class="translucent-button rounded-full px-4 py-2 hover:text-primary transition-colors" style="display: none;">Profile</a>
</nav>
<script>
function openDropdown(element) {
  const dropdown = element.querySelector('.absolute');
  if (dropdown) {
    dropdown.classList.remove('hidden');
    dropdown.classList.add('block');
  }
}

function closeDropdown(element) {
  const dropdown = element.querySelector('.absolute');
  if (dropdown) {
    dropdown.classList.add('hidden');
    dropdown.classList.remove('block');
  }
}

// Also add click functionality for better UX
document.addEventListener('DOMContentLoaded', function() {
  const dropdownButtons = document.querySelectorAll('.relative.group button');
  dropdownButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const dropdown = this.parentElement.querySelector('.absolute');
      if (dropdown) {
        if (dropdown.classList.contains('hidden')) {
          // Close other dropdowns first
          document.querySelectorAll('.absolute').forEach(d => {
            d.classList.add('hidden');
            d.classList.remove('block');
          });
          // Open this dropdown
          dropdown.classList.remove('hidden');
          dropdown.classList.add('block');
        } else {
          // Close this dropdown
          dropdown.classList.add('hidden');
          dropdown.classList.remove('block');
        }
      }
    });
  });

  // Close dropdowns when clicking outside
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.relative.group')) {
      document.querySelectorAll('.absolute').forEach(dropdown => {
        dropdown.classList.add('hidden');
        dropdown.classList.remove('block');
      });
    }
  });
});
</script>
<div class="flex items-center gap-4">
<div id="navbar-profile" class="hidden sm:flex items-center gap-3 cursor-pointer relative">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 shadow-[0_0_15px_rgba(128,19,236,0.5)]" id="navbar-profile-photo">
<span class="material-symbols-outlined text-xl text-[var(--primary-color)] flex items-center justify-center w-full h-full">person</span>
</div>
<div class="flex flex-col">
<div class="text-white text-sm font-medium" id="navbar-name">User</div>
<div class="text-[#ad92c9] text-xs" id="navbar-class-role">Student</div>
</div>
<!-- Dropdown Menu -->
<div id="navbar-dropdown" class="absolute top-full right-0 mt-2 w-48 rounded-md shadow-lg bg-[#1A1122] backdrop-blur-sm border border-[#2A1F36] ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-50">
<div class="py-1">
                        <a href="profile.html" class="flex items-center gap-3 px-4 py-2 text-sm text-white hover:bg-[#362348] transition-colors">
                            <span class="material-symbols-outlined text-base">person</span>
                            <span>See Profile</span>
                        </a>
                        <a href="profile.html" class="flex items-center gap-3 px-4 py-2 text-sm text-white hover:bg-[#362348] transition-colors">
                            <span class="material-symbols-outlined text-base">edit</span>
                            <span>Edit Profile</span>
                        </a>
<button id="navbar-sign-out-btn" class="flex items-center gap-3 px-4 py-2 text-sm text-white hover:bg-[#362348] transition-colors w-full text-left">
<span class="material-symbols-outlined text-base">logout</span>
<span>Sign Out</span>
</button>
</div>
</div>
</div>
<button id="theme-toggle" class="translucent-button flex items-center justify-center rounded-full size-11 hover:scale-110 transition-transform">
<span class="material-symbols-outlined text-2xl">dark_mode</span>
</button>
<button class="xl:hidden translucent-button flex items-center justify-center rounded-full size-11" id="mobile-menu-btn">
<span class="material-symbols-outlined text-2xl">menu</span>
</button>
</div>
</header>

    <!-- Side Menu -->
    <div id="side-menu" class="fixed top-0 left-0 h-full w-64 bg-secondary/95 backdrop-blur-md border-r border-primary z-50">
        <div class="p-6">
            <!-- User Profile Box -->
            <div onclick="window.location.href='profile.html'" class="flex items-center gap-3 mb-8 p-4 bg-tertiary/50 rounded-lg border border-primary/30 cursor-pointer hover:bg-tertiary/70 transition-colors">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-12 shadow-[0_0_15px_rgba(128,19,236,0.5)]" id="side-profile-photo">
                    <span class="material-symbols-outlined text-xl text-[var(--primary-color)] flex items-center justify-center w-full h-full">person</span>
                </div>
                <div class="flex flex-col">
                    <div class="text-white text-sm font-medium" id="side-name">User</div>
                    <div class="text-[#ad92c9] text-xs" id="side-class-role">Student</div>
                </div>
            </div>

            <!-- Menu Items -->
            <nav class="space-y-2">
                <a href="rewards.html" class="flex items-center gap-3 px-4 py-3 text-secondary hover:bg-primary/20 hover:text-primary transition-colors rounded-lg">
                    <span class="material-symbols-outlined text-accent">emoji_events</span>
                    <span>Rewards</span>
                </a>
                <a href="profile.html" class="flex items-center gap-3 px-4 py-3 text-secondary hover:bg-primary/20 hover:text-primary transition-colors rounded-lg">
                    <span class="material-symbols-outlined text-accent">person</span>
                    <span>Profile</span>
                </a>
                <a href="study-library.html" class="flex items-center gap-3 px-4 py-3 text-secondary hover:bg-primary/20 hover:text-primary transition-colors rounded-lg">
                    <span class="material-symbols-outlined text-accent">library_books</span>
                    <span>Study Library</span>
                </a>
                <a href="mood-selection.html" class="flex items-center gap-3 px-4 py-3 text-secondary hover:bg-primary/20 hover:text-primary transition-colors rounded-lg">
                    <span class="material-symbols-outlined text-accent">mood</span>
                    <span>Mood Tracker</span>
                </a>
                <a href="study-library.html" class="flex items-center gap-3 px-4 py-3 text-secondary hover:bg-primary/20 hover:text-primary transition-colors rounded-lg">
                    <span class="material-symbols-outlined text-accent">upload</span>
                    <span>Upload Study Material</span>
                </a>
                <a href="feedback.html" class="flex items-center gap-3 px-4 py-3 text-secondary hover:bg-primary/20 hover:text-primary transition-colors rounded-lg">
                    <span class="material-symbols-outlined text-accent">feedback</span>
                    <span>Feedback Us</span>
                </a>
            </nav>

            <!-- Sign Out Button -->
            <div class="absolute bottom-6 left-6 right-6">
                <button onclick="signOut()" class="w-full flex items-center gap-3 px-4 py-3 text-secondary hover:bg-red-500/20 hover:text-red-400 transition-colors rounded-lg">
                    <span class="material-symbols-outlined text-red-400">logout</span>
                    <span>Sign Out</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div id="menu-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 invisible transition-opacity duration-300 ease-in-out z-40"></div>

    <div class="min-h-screen p-8 ml-64">
        <div class="max-w-7xl mx-auto">
            <!-- Welcome Section -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-primary mb-2" id="welcome-message">Welcome back!</h1>
                <p class="text-secondary">Track your progress and stay focused on your goals.</p>
            </div>

            <!-- Stats Overview -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Focus Points -->
                <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <span class="material-symbols-outlined text-3xl text-accent">stars</span>
                        <span class="text-2xl font-bold text-accent" id="focus-points">0</span>
                    </div>
                    <h3 class="text-lg font-bold text-primary mb-1">Focus Points</h3>
                    <p class="text-sm text-secondary">Level <span id="avatar-level">1</span></p>
                    <div class="mt-3 w-full bg-tertiary rounded-full h-2">
                        <div class="bg-accent h-2 rounded-full transition-all duration-500" id="level-progress" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Total Sessions -->
                <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <span class="material-symbols-outlined text-3xl text-accent">timer</span>
                        <span class="text-2xl font-bold text-accent" id="total-sessions">0</span>
                    </div>
                    <h3 class="text-lg font-bold text-primary mb-1">Focus Sessions</h3>
                    <p class="text-sm text-secondary"><span id="total-minutes">0</span> minutes total</p>
                </div>

                <!-- Today's Progress -->
                <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <span class="material-symbols-outlined text-3xl text-accent">today</span>
                        <span class="text-2xl font-bold text-accent" id="today-sessions">0</span>
                    </div>
                    <h3 class="text-lg font-bold text-primary mb-1">Today's Sessions</h3>
                    <p class="text-sm text-secondary"><span id="today-minutes">0</span> minutes today</p>
                </div>

                <!-- Mood Average -->
                <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <span class="material-symbols-outlined text-3xl text-accent">mood</span>
                        <span class="text-2xl font-bold text-accent" id="avg-mood">0</span>
                    </div>
                    <h3 class="text-lg font-bold text-primary mb-1">Mood Average</h3>
                    <p class="text-sm text-secondary" id="mood-trend">‚Üí Stable</p>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Focus Timer -->
                <div class="lg:col-span-2 bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                    <h2 class="text-2xl font-bold text-primary mb-6">Focus Timer</h2>
                    <div class="text-center">
                        <div class="mb-6">
                            <div class="w-32 h-32 mx-auto bg-center bg-no-repeat aspect-square bg-cover rounded-full border-2 border-accent" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDfd-joboe9xIoKtUc4hl2jVktQM-V1N3YX8OgXrfPUxZiBgt74XR5WtJfBxsdBl7av2tJbosZROY157DNMjwOJ3UPSiLPVk4Z2IzmHDcxGM8NjxnoIqz_FpuTSDFkMtVHc8_x9izwetsNYUiEg-t7mwPBTg_v2lp5HDySnPsB71LzS-kg8aihsn0g3tnZ26Smwv6ctsVLs05kme6ecPIAEPguvRiEvNQSeKSF9Utp5vZvfnvGbs_4bQGZUUn12N-bOvBRtIXFxEDk");'></div>
                        </div>
                        <p id="timer-display" class="text-4xl font-mono text-secondary tracking-widest mb-6">25:00</p>
                        <div class="flex gap-2 mb-4 justify-center">
                            <button id="time-15" class="translucent-button px-3 py-1 text-sm rounded-full">15 min</button>
                            <button id="time-25" class="translucent-button px-3 py-1 text-sm rounded-full bg-accent text-primary">25 min</button>
                            <button id="time-30" class="translucent-button px-3 py-1 text-sm rounded-full">30 min</button>
                            <button id="time-45" class="translucent-button px-3 py-1 text-sm rounded-full">45 min</button>
                        </div>
                        <div class="flex gap-2 justify-center">
                            <button id="start-btn" class="translucent-button flex shrink-0 items-center justify-center rounded-full size-16 hover:scale-110 transition-transform duration-200 shadow-lg shadow-accent/30">
                                <span class="material-symbols-outlined text-4xl">play_arrow</span>
                            </button>
                            <button id="pause-btn" class="translucent-button flex shrink-0 items-center justify-center rounded-full size-16 hover:scale-110 transition-transform duration-200 shadow-lg shadow-accent/30" style="display: none;">
                                <span class="material-symbols-outlined text-4xl">pause</span>
                            </button>
                            <button id="reset-btn" class="translucent-button flex shrink-0 items-center justify-center rounded-full size-16 hover:scale-110 transition-transform duration-200 shadow-lg shadow-accent/30">
                                <span class="material-symbols-outlined text-4xl">replay</span>
                            </button>
                        </div>
                        <div class="mt-6">
                            <div class="flex justify-between mb-1 items-center">
                                <span class="text-base font-medium text-primary">Focus Level</span>
                                <span id="progress-text" class="text-sm font-bold text-accent px-2 py-1 rounded-full bg-accent/20">0%</span>
                            </div>
                            <div class="w-full bg-tertiary rounded-full h-3 overflow-hidden">
                                <div id="progress-bar" class="bg-accent h-3 rounded-full transition-all duration-500 ease-in-out shadow-lg shadow-accent/50" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="space-y-6">
                    <!-- Mood Tracker -->
                    <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                        <h3 class="text-lg font-bold text-primary mb-4">Quick Mood Check</h3>
                        <div class="grid grid-cols-2 gap-2 mb-4">
                            <button onclick="window.location.href='mood-selection.html'" class="translucent-button p-3 rounded-lg text-center hover:scale-105 transition-transform">
                                <span class="text-2xl block mb-1">üòÑ</span>
                                <span class="text-xs">Happy</span>
                            </button>
                            <button onclick="window.location.href='mood-selection.html'" class="translucent-button p-3 rounded-lg text-center hover:scale-105 transition-transform">
                                <span class="text-2xl block mb-1">üòê</span>
                                <span class="text-xs">Neutral</span>
                            </button>
                            <button onclick="window.location.href='mood-selection.html'" class="translucent-button p-3 rounded-lg text-center hover:scale-105 transition-transform">
                                <span class="text-2xl block mb-1">üòî</span>
                                <span class="text-xs">Sad</span>
                            </button>
                            <button onclick="window.location.href='mood-selection.html'" class="translucent-button p-3 rounded-lg text-center hover:scale-105 transition-transform">
                                <span class="text-2xl block mb-1">üòü</span>
                                <span class="text-xs">Anxious</span>
                            </button>
                        </div>
                        <button onclick="window.location.href='mood-selection.html'" class="w-full translucent-button py-2 rounded-lg text-sm font-medium">
                            View All Moods
                        </button>
                    </div>

                    <!-- Study Library -->
                    <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                        <h3 class="text-lg font-bold text-primary mb-4">Study Resources</h3>
                        <div class="space-y-3">
                            <button onclick="window.location.href='study-library.html'" class="w-full translucent-button py-3 rounded-lg flex items-center gap-3 hover:scale-105 transition-transform">
                                <span class="material-symbols-outlined text-accent">library_books</span>
                                <span>Browse Study Materials</span>
                            </button>
                            <button onclick="window.location.href='study-library.html'" class="w-full translucent-button py-3 rounded-lg flex items-center gap-3 hover:scale-105 transition-transform">
                                <span class="material-symbols-outlined text-accent">upload</span>
                                <span>Upload Material</span>
                            </button>
                        </div>
                    </div>

                    <!-- Rewards -->
                    <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                        <h3 class="text-lg font-bold text-primary mb-4">Your Progress</h3>
                        <div class="space-y-3">
                            <button onclick="window.location.href='rewards.html'" class="w-full translucent-button py-3 rounded-lg flex items-center gap-3 hover:scale-105 transition-transform">
                                <span class="material-symbols-outlined text-accent">emoji_events</span>
                                <span>View Rewards</span>
                            </button>
                            <button onclick="window.location.href='profile.html'" class="w-full translucent-button py-3 rounded-lg flex items-center gap-3 hover:scale-105 transition-transform">
                                <span class="material-symbols-outlined text-accent">person</span>
                                <span>Edit Profile</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Recent Moods -->
                <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                    <h3 class="text-lg font-bold text-primary mb-4">Recent Moods</h3>
                    <div id="recent-moods" class="space-y-2">
                        <!-- Recent moods will be loaded here -->
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                    <h3 class="text-lg font-bold text-primary mb-4">Recent Activity</h3>
                    <div id="recent-activity" class="space-y-2">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Study Materials -->
            <div class="mt-8 bg-secondary/50 backdrop-blur-sm border border-primary rounded-xl p-6">
                <h3 class="text-lg font-bold text-primary mb-4">Your Study Materials</h3>
                <div id="recent-materials" class="space-y-2">
                    <!-- Recent materials will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Focus Timer Script -->
    <script>
        // Focus Timer Functionality
        let selectedTime = 25 * 60; // Default 25 minutes in seconds
        let timeLeft = selectedTime;
        let isRunning = false;
        let timerInterval;
        const timerDisplay = document.getElementById('timer-display');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const timeButtons = document.querySelectorAll('#time-15, #time-25, #time-30, #time-45');

        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateProgress() {
            const totalTime = selectedTime;
            const elapsed = totalTime - timeLeft;
            const progress = Math.min((elapsed / totalTime) * 100, 100);
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${Math.round(progress)}%`;
        }

        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                startBtn.style.display = 'none';
                pauseBtn.style.display = 'flex';
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateDisplay();
                    updateProgress();
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        isRunning = false;
                        startBtn.style.display = 'flex';
                        pauseBtn.style.display = 'none';
                        alert('Session complete! Great job maintaining focus.');
                    }
                }, 1000);
            }
        }

        function pauseTimer() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
                startBtn.style.display = 'flex';
                pauseBtn.style.display = 'none';
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            timeLeft = selectedTime;
            updateDisplay();
            updateProgress();
            startBtn.style.display = 'flex';
            pauseBtn.style.display = 'none';
        }

        function selectTime(minutes) {
            selectedTime = minutes * 60;
            resetTimer();
            timeButtons.forEach(btn => {
                btn.classList.remove('bg-accent', 'text-primary');
            });
            const activeBtn = document.getElementById(`time-${minutes}`);
            activeBtn.classList.add('bg-accent', 'text-primary');
        }

        // Event Listeners
        startBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resetBtn.addEventListener('click', resetTimer);

        timeButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const minutes = parseInt(this.id.split('-')[1]);
                selectTime(minutes);
            });
        });

        // Initial updates
        updateDisplay();
        updateProgress();

        // Side Menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sideMenu = document.getElementById('side-menu');
            const menuOverlay = document.getElementById('menu-overlay');
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = themeToggle.querySelector('span');

            function toggleMenu() {
                const isOpen = !sideMenu.classList.contains('-translate-x-full');
                if (isOpen) {
                    sideMenu.classList.add('-translate-x-full');
                    menuOverlay.classList.add('opacity-0', 'invisible');
                } else {
                    sideMenu.classList.remove('-translate-x-full');
                    menuOverlay.classList.remove('opacity-0', 'invisible');
                }
            }

            mobileMenuBtn.addEventListener('click', toggleMenu);
            menuOverlay.addEventListener('click', toggleMenu);

            // Close menu on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !sideMenu.classList.contains('-translate-x-full')) {
                    toggleMenu();
                }
            });

            // Hide mobile menu button since side menu is now always visible
            mobileMenuBtn.style.display = 'none';

            // Theme toggle functionality
            themeToggle.addEventListener('click', function() {
                const root = document.documentElement;
                const isDark = localStorage.getItem('theme') !== 'light';

                if (isDark) {
                    // Switch to light theme
                    root.style.setProperty('--bg-primary', '#FFFFFF');
                    root.style.setProperty('--bg-secondary', '#F0F9FF');
                    root.style.setProperty('--bg-tertiary', '#E0F2FE');
                    root.style.setProperty('--text-primary', '#0F172A');
                    root.style.setProperty('--text-secondary', '#334155');
                    root.style.setProperty('--border-primary', '#E0F2FE');
                    themeIcon.textContent = 'light_mode';
                    localStorage.setItem('theme', 'light');
                } else {
                    // Switch to dark theme
                    root.style.setProperty('--bg-primary', '#120B1A');
                    root.style.setProperty('--bg-secondary', '#1A1122');
                    root.style.setProperty('--bg-tertiary', '#2A1F36');
                    root.style.setProperty('--text-primary', '#FFFFFF');
                    root.style.setProperty('--text-secondary', '#ad92c9');
                    root.style.setProperty('--border-primary', '#2A1F36');
                    themeIcon.textContent = 'dark_mode';
                    localStorage.setItem('theme', 'dark');
                }
            });

            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.documentElement.style.setProperty('--bg-primary', '#FFFFFF');
                document.documentElement.style.setProperty('--bg-secondary', '#F0F9FF');
                document.documentElement.style.setProperty('--bg-tertiary', '#E0F2FE');
                document.documentElement.style.setProperty('--text-primary', '#0F172A');
                document.documentElement.style.setProperty('--text-secondary', '#334155');
                document.documentElement.style.setProperty('--border-primary', '#E0F2FE');
                themeIcon.textContent = 'light_mode';
            } else {
                document.documentElement.style.setProperty('--bg-primary', '#120B1A');
                document.documentElement.style.setProperty('--bg-secondary', '#1A1122');
                document.documentElement.style.setProperty('--bg-tertiary', '#2A1F36');
                document.documentElement.style.setProperty('--text-primary', '#FFFFFF');
                document.documentElement.style.setProperty('--text-secondary', '#ad92c9');
                document.documentElement.style.setProperty('--border-primary', '#2A1F36');
                themeIcon.textContent = 'dark_mode';
            }

            // Navbar dropdown functionality
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');

            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const dropdown = this.nextElementSibling;
                    // Hide other dropdowns
                    document.querySelectorAll('.dropdown-toggle + div').forEach(d => {
                        if (d !== dropdown) d.classList.add('hidden');
                    });
                    dropdown.classList.toggle('hidden');
                });
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', function() {
                document.querySelectorAll('.dropdown-toggle + div').forEach(d => d.classList.add('hidden'));
            });
        });
    </script>
</body>
</html>
